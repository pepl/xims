# $Id$

# Be sure that AxKit is loaded
PerlModule AxKit

# Set to "On" in development environments
PerlWarn Off

# For Portlets
AddType text/xml .ptlt

# this has to be set in case xims is not installed under default path
#PerlSetEnv XIMS_HOME path_to_your_xims_home

# XIMS-Config is loaded at Apache startup
<Location /goxims>
    SetHandler perl-script
    PerlHandler goxims
    PerlAccessHandler Apache::AuthXIMS

    # If your installation is running behind a reverse proxy that
    # terminates SSL connections or behind a LB that does port
    # mapping, configure the following:
    #   
    # Set this to allow the utilisation of the various X-Forwarded-*
    # headers
    #
    #PerlSetVar ximsTrustProxyHeaders 1
    #
    # The server url will be determined from the following sources: If
    # the ximsServerURL variable (right below) has a value, use that.
    # If ximsServerURL is not present: Either deduce the value from
    # the X-Forwarded-Host and X-SSL-Connection request headers in
    # case we are configured to trust proxy headers (right above);
    # otherwise simply use the parsed URI of the current request.
    #
    #PerlSetVar ximsServerURL https://some.host.tld
 
    # Overrides the default "Cache-Control: no-cache" header. The
    # HTTP/1.0 "Pragma: no-cache" is sent unless you set
    # "ximsCacheControl" to "public".
    #
    # This setting takes effect in Apache::AuthXIMS and might be useful
    # in intranet scenarios and solving issues w/ IE's file-download
    # mechanism.

    # PerlSetVar ximsCacheControl private

    # per default we are using passwords stored in the RDBMS for
    # authentication

    PerlSetVar ximsAuthStyle XIMS::Auth::Password

    # we could also use an IMAP or LDAP server:

    # PerlSetVar ximsAuthStyle XIMS::Auth::IMAP

    # ximsAuthServer has to be set for XIMS::Auth::IMAP and
    # XIMS::Auth::LDAP

    # PerlSetVar ximsAuthServer imap_host
 
    # this should be set for oracle
    #PerlSetEnv ORACLE_HOME path_to_your_oracle_home

    # set custom error-pages
    ErrorDocument 500 /ximspubroot/500.xsp
    ErrorDocument 403 /ximspubroot/access.xsp
    ErrorDocument 404 /ximspubroot/404.xsp


    # Add XSP taglibs here if you plan to use XIMS object type XSP
    AxAddXSPTaglib AxKit::XSP::Util
    AxAddXSPTaglib AxKit::XSP::Param
    AxAddXSPTaglib AxKit::XSP::IfParam
    AxAddXSPTaglib AxKit::XSP::WebUtils
    # AxDebugLevel 10
</Location>

# For things like XIMS::AnonDiscussionForums for example, we may want to
# use public-access to XIMS content. We use the special memberless role
# 'public' for that. If your 'public' role is named differently at your
# XIMS installation, you will have to change the value of ximsPublic
# accordingly.
#
# Public access will work only, if 'ximsPublic' is set and the
# PerlAccessHandler Apache::AuthXIMS is not used in the config.
<Location /gopublic>
    SetHandler perl-script
    PerlHandler goxims
    # we cannot use user-id here because with an ID of "0" undef is
    # returned by dir_config()
    PerlSetVar ximsPublicUserName public
    PerlSetVar ximsgoxims /gopublic

    # If your installation is running behind a reverse proxy that
    # terminates SSL connections or behind a LB that does port
    # mapping, configure the following:
    #   
    # Set this to allow the utilisation of the various X-Forwarded-*
    # headers
    #
    #PerlSetVar ximsTrustProxyHeaders 1
    #
    # The server url will be determined from the following sources: If
    # the ximsServerURL variable (right below) has a value, use that.
    # If ximsServerURL is not present: Either deduce the value from
    # the X-Forwarded-Host and X-SSL-Connection request headers in
    # case we are configured to trust proxy headers (right above);
    # otherwise simply use the parsed URI of the current request.
    #
    #PerlSetVar ximsServerURL https://some.host.tld

    # this should be set for oracle
    #PerlSetEnv ORACLE_HOME path_to_your_oracle_home

    ErrorDocument 500 /ximspubroot/500.xsp
    ErrorDocument 403 /ximspubroot/access.xsp
    ErrorDocument 404 /ximspubroot/404.xsp
    # AxDebugLevel 10
</Location>

# For limited automated clients who cannot deal with session cookies it
# may be useful to grab data inside a cookie less Basic Auth protected
# pseudo session.
#
# E.g.:
#
# Users want to use the reporting facilities of MS-Access for a XIMS
# SimpleDB object. Using VB's WinHttpRequest object, the Access import
# data can be grabbed via
# /gobaxims/content/xims/simpledb?style=access_xmlimport after the
# BasicAuth credentials have been passed using an Access form.
# Application.ImportXML can then import the data to a table.
<Location /gobaxims>
    SetHandler perl-script
    PerlHandler goxims
    PerlSetVar ximsgoxims /gobaxims

    # If your installation is running behind a reverse proxy that
    # terminates SSL connections or behind a LB that does port
    # mapping, configure the following:
    #   
    # Set this to allow the utilisation of the various X-Forwarded-*
    # headers
    #
    #PerlSetVar ximsTrustProxyHeaders 1
    #
    # The server url will be determined from the following sources: If
    # the ximsServerURL variable (right below) has a value, use that.
    # If ximsServerURL is not present: Either deduce the value from
    # the X-Forwarded-Host and X-SSL-Connection request headers in
    # case we are configured to trust proxy headers (right above);
    # otherwise simply use the parsed URI of the current request.
    #
    #PerlSetVar ximsServerURL https://some.host.tld

    # Authentication Realm and Type (only Basic supported)
    AuthName "XIMS Authentication"
    AuthType Basic

    PerlAuthenHandler Apache::BasicAuthXIMS

    # this should be set for oracle
    #PerlSetEnv ORACLE_HOME path_to_your_oracle_home

    require valid-user
</Location>

# Work around behaviour (bug) described in
# http://support.microsoft.com/?kbid=831805
RewriteEngine On
RewriteCond %{REQUEST_METHOD}  ^OPTIONS$
RewriteRule  ^/$               /godav/  [L]

<Location /godav>
    SetHandler perl-script
    PerlHandler godav

    # If your installation is running behind a reverse proxy that
    # terminates SSL connections or behind a LB that does port
    # mapping, configure the following:
    #   
    # Set this to allow the utilisation of the various X-Forwarded-*
    # headers
    #
    #PerlSetVar ximsTrustProxyHeaders 1
    #
    # The server url will be determined from the following sources: If
    # the ximsServerURL variable (right below) has a value, use that.
    # If ximsServerURL is not present: Either deduce the value from
    # the X-Forwarded-Host and X-SSL-Connection request headers in
    # case we are configured to trust proxy headers (right above);
    # otherwise simply use the parsed URI of the current request.
    #
    #PerlSetVar ximsServerURL https://some.host.tld

    # Authentication Realm and Type (only Basic supported)
    AuthName "XIMS Authentication"
    AuthType Basic

    PerlAuthenHandler Apache::BasicAuthXIMS
    #PerlAuthzHandler Apache::BasicAuthXIMS::authz

    # this should be set for oracle PerlSetEnv ORACLE_HOME
    #PerlSetEnv ORACLE_HOME path_to_your_oracle_home

    require valid-user
    #require user   xgu
    #require group  admins
</Location>

<Location /ximspubroot/>
    # adapt to your needs - '_ottereendex.html' is the default value of
    # XIMS::Config::AutoIndexFilename()
    DirectoryIndex index.xsp index.pl index.cgi index.html index.htm index.xml galleryindex.html _ottereendex.html
</Location>

<Location /ximspubroot/*.xsp>
    SetHandler AxKit

    AxResetProcessors
    AxGzipOutput On

    AxAddStyleMap application/x-xsp Apache::AxKit::Language::XSP
    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT

    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl

    AxAddPlugin Apache::AxKit::Plugin::AddXSLParams::Request
    PerlSetVar AxAddXSLParamGroups "Request-Common HTTPHeaders VerboseURI"

    AxAddProcessor application/x-xsp NULL
    AxAddProcessor text/xsl /ximspubroot/stylesheets/default.xsl

    AxAddXSPTaglib AxKit::XSP::Param
    AxAddXSPTaglib AxKit::XSP::IfParam
    AxAddXSPTaglib AxKit::XSP::WebUtils
    # AxDebugLevel 10
</Location>

<Location ~ "^/ximspubroot/.*\.html">
    SetHandler axkit

    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl

    AxAddPlugin Apache::AxKit::Plugin::Passthru
    AxAddPlugin Apache::AxKit::StyleChooser::UserAgent
    AxAddPlugin Apache::AxKit::StyleChooser::QueryString

    AxAddPlugin Apache::AxKit::Plugin::AddXSLParams::Request
    PerlSetVar AxAddXSLParamGroups "Request-Common HTTPHeaders"

    PerlSetVar AxUAStyleMap "#default => IE, textonly => Lynx"
    <AxMediaType screen>
        <AxStyleName "#default">
            AxAddProcessor text/xsl /ximspubroot/stylesheets/default.xsl
        </AxStyleName>
        <AxStyleName print>
            AxAddProcessor text/xsl /ximspubroot/stylesheets/default_print.xsl
        </AxStyleName>
       <AxStyleName textonly>
           AxAddProcessor text/xsl /ximspubroot/stylesheets/default_textonly.xsl
        </AxStyleName>
    </AxMediaType>
    #AxDebugLevel 5
</Location>

<Location ~ "^/ximspubroot/.*\.axp">
    SetHandler axkit

    AxAddPlugin Apache::AxKit::Plugin::Passthru
    AxAddStyleMap application/x-axpoint Apache::AxKit::Language::AxPoint
    AxAddRootProcessor application/x-axpoint NULL slideshow

    #PerlSetVar AxTranslateOutput 1
    #PerlSetVar AxOutputCharset iso-8859-1
    #AxDebugLevel 5
</Location>

<Location ~ "^/ximspubroot/.*\.sdbk">
    SetHandler axkit

    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl

    AxAddPlugin Apache::AxKit::Plugin::Passthru

    AxAddPlugin Apache::AxKit::Plugin::QueryStringCache
    AxAddPlugin Apache::AxKit::Plugin::AddXSLParams::Request
    PerlSetVar AxAddXSLParamGroups "Request-Common HTTPHeaders"

    AxAddProcessor text/xsl /ximspubroot/stylesheets/sdocbook_default.xsl
    #AxDebugLevel 5
</Location>

<Location ~ "^/ximspubroot/.*\.xml">
    SetHandler axkit

    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl

    AxAddPlugin Apache::AxKit::Plugin::Passthru
    #AxDebugLevel 5
</Location>

<Location ~ "^/ximspubroot/htmlarea/.*\.xml">
    SetHandler default
</Location>

<Location ~ "^/ximspubroot/.*/galleria/_ottereendex.html">
    # '_ottereendex.html' is the default value of
    # XIMS::Config::AutoIndexFilename()
    SetHandler axkit
    AxResetProcessors

    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl

    AxAddPlugin Apache::AxKit::Plugin::Passthru
    PerlSetVar AxAddXSLParamGroups "Request-Common HTTPHeaders"

    AxAddProcessor text/xsl /ximspubroot/stylesheets/galleria.xsl
    AxDebugLevel 5
</Location>
<Location ~ "^/ximspubroot/.*/galleria/.*\.[jpg|gif|png|tif]">
    PerlFixupHandler Apache::ImageMagick
    PerlSetVar AIMCacheDir /var/cache/AIMCache
    PerlSetVar AIMCheckMTime on
    PerlSetVar AIMDisableSearch on
</Location>

<Location ~ ".*\.ptlt\.rss"> #\?style=
    SetHandler axkit
    AxResetProcessors
    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl
    AxAddPlugin Apache::AxKit::StyleChooser::FileSuffix
    <AxMediaType screen>
        <AxStyleName "#default">
            AxAddProcessor text/xsl /ximspubroot/stylesheets/portlet_rss2.xsl
        </AxStyleName>
        <AxStyleName rss>
            AxAddProcessor text/xsl /ximspubroot/stylesheets/portlet_rss2.xsl
        </AxStyleName>
    </AxMediaType>
    #AxDebugLevel 5
</Location>

<Location ~ ".*\.ptlt\.rdf"> #\?style=
    SetHandler axkit
    AxResetProcessors
    AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
    AxErrorStylesheet text/xsl /ximspubroot/stylesheets/error.xsl
    AxAddPlugin Apache::AxKit::StyleChooser::FileSuffix
    <AxMediaType screen>
        <AxStyleName "#default">
            AxAddProcessor text/xsl /ximspubroot/stylesheets/portlet_rss1.xsl
        </AxStyleName>
        <AxStyleName rdf>
            AxAddProcessor text/xsl /ximspubroot/stylesheets/portlet_rss1.xsl
        </AxStyleName>
    </AxMediaType>
    #AxDebugLevel 5
</Location>

# Local Variables:
#   mode: apache-conf-generic
# End:
# ex: set ts=4 sr sw=4 tw=78 ft=apache et :

